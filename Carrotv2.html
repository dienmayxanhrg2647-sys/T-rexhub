<!DOCTYPE html>
<html><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1.0"><title>Carrot Warrior</title></head>
<body style="margin:0;background:#000;overflow:hidden">
<canvas id="c" style="display:block;background:#87CEEB"></canvas>
<div style="position:fixed;top:15px;left:15px;color:#fff;font:bold 24px Arial;z-index:10;background:rgba(0,0,0,.8);padding:15px 25px;border-radius:15px;text-shadow:2px 2px 4px #000">
‚ù§Ô∏è <span id="hp">100</span> üíÄ <span id="k">0</span> üê∞ <span id="p">0/20</span> üìà Lv.<span id="lv">1</span>
</div>
<div style="position:fixed;bottom:30px;width:100%;display:flex;justify-content:space-between;padding:0 30px;z-index:10">
<div style="display:flex;gap:15px">
<button id="L" style="width:85px;height:85px;font-size:38px;background:linear-gradient(145deg,#667eea,#764ba2);color:#fff;border:5px solid rgba(255,255,255,.3);border-radius:22px">‚óÄ</button>
<button id="R" style="width:85px;height:85px;font-size:38px;background:linear-gradient(145deg,#667eea,#764ba2);color:#fff;border:5px solid rgba(255,255,255,.3);border-radius:22px">‚ñ∂</button>
</div>
<div style="display:flex;gap:12px">
<button id="J" style="width:80px;height:80px;font-size:34px;background:linear-gradient(145deg,#FF6B6B,#FF8E53);color:#fff;border:5px solid rgba(255,255,255,.3);border-radius:22px">‚Üë</button>
<button id="SK1" style="width:75px;height:75px;font-size:28px;background:linear-gradient(145deg,#9D50BB,#6E48AA);color:#fff;border:5px solid rgba(255,255,255,.3);border-radius:22px"><span id="sb1">‚ö°</span></button>
<button id="SK2" style="width:75px;height:75px;font-size:28px;background:linear-gradient(145deg,#2ECC71,#27AE60);color:#fff;border:5px solid rgba(255,255,255,.3);border-radius:22px"><span id="sb2">üó°Ô∏è</span></button>
<button id="S" style="width:80px;height:80px;font-size:34px;background:linear-gradient(145deg,#FFA500,#FF6347);color:#fff;border:5px solid rgba(255,255,255,.3);border-radius:22px">ü•ï</button>
</div></div><script>
const c=document.getElementById('c'),ctx=c.getContext('2d');c.width=innerWidth;c.height=innerHeight;addEventListener('resize',()=>{c.width=innerWidth;c.height=innerHeight});
const cam={x:0},pl={x:200,y:0,w:45,h:65,vx:0,vy:0,hp:100,dir:1,onG:0},k={l:0,r:0,j:0,s:0,sk1:0,sk2:0};
const bul=[],enm=[],mins=[],bombs=[],giants=[],reds=[];let kills=0,bCnt=0,boss=0,lastS=0,lastE=0,lastSk1=0,lastSk2=0,level=1,bossReq=20;
const audioCtx=new(AudioContext||webkitAudioContext)();function playShoot(){try{const osc=audioCtx.createOscillator(),gain=audioCtx.createGain();osc.connect(gain);gain.connect(audioCtx.destination);osc.frequency.setValueAtTime(800,audioCtx.currentTime);osc.frequency.exponentialRampToValueAtTime(200,audioCtx.currentTime+.1);gain.gain.setValueAtTime(.3,audioCtx.currentTime);gain.gain.exponentialRampToValueAtTime(.01,audioCtx.currentTime+.1);osc.start(audioCtx.currentTime);osc.stop(audioCtx.currentTime+.1)}catch(e){}}
const bind=(id,key)=>{const b=document.getElementById(id);b.ontouchstart=b.onmousedown=e=>{e.preventDefault();k[key]=1};b.ontouchend=b.onmouseup=e=>{e.preventDefault();k[key]=0}};
bind('L','l');bind('R','r');bind('J','j');bind('S','s');bind('SK1','sk1');bind('SK2','sk2');
addEventListener('keydown',e=>{if(e.key==='ArrowLeft'||e.key==='a')k.l=1;if(e.key==='ArrowRight'||e.key==='d')k.r=1;if(e.key==='ArrowUp'||e.key==='w'||e.key===' ')k.j=1;if(e.key==='f')k.s=1;if(e.key==='q')k.sk1=1;if(e.key==='e')k.sk2=1});
addEventListener('keyup',e=>{if(e.key==='ArrowLeft'||e.key==='a')k.l=0;if(e.key==='ArrowRight'||e.key==='d')k.r=0;if(e.key==='ArrowUp'||e.key==='w'||e.key===' ')k.j=0;if(e.key==='f')k.s=0;if(e.key==='q')k.sk1=0;if(e.key==='e')k.sk2=0});
class Min{constructor(x,y,s){if(s==='left')this.x=x-50;else if(s==='right')this.x=x+50;else if(s==='left2')this.x=x-80;else if(s==='right2')this.x=x+80;this.y=y;this.w=25;this.h=35;this.hp=80+level*15;this.max=this.hp;this.vy=0;this.vx=0;this.last=0;this.drainTarget=null;this.lastDrain=0}up(g){let n=null,d=999999;for(let e of enm){const dist=Math.sqrt((e.x-this.x)**2+(e.y-this.y)**2);if(dist<d){d=dist;n=e}}if(n&&d>80)this.vx=n.x>this.x?3:n.x<this.x?-3:0;else this.vx=0;this.x+=this.vx;this.vy+=.85;this.y+=this.vy;if(this.y+this.h>=g){this.y=g-this.h;this.vy=0}}dr(cx){const x=this.x-cx,y=this.y;ctx.fillStyle='rgba(0,0,0,.2)';ctx.fillRect(x+5,y+this.h+2,this.w-10,6);const gr=ctx.createLinearGradient(x,y,x,y+this.h);gr.addColorStop(0,'#FF8C42');gr.addColorStop(1,'#FFA500');ctx.fillStyle=gr;ctx.beginPath();ctx.moveTo(x+this.w/2,y+this.h);ctx.lineTo(x+this.w,y+this.h*.3);ctx.lineTo(x+this.w/2,y);ctx.lineTo(x,y+this.h*.3);ctx.fill();ctx.fillStyle='#228B22';ctx.fillRect(x+this.w/2-6,y-5,5,8);ctx.fillRect(x+this.w/2+1,y-6,5,8);ctx.fillStyle='#000';ctx.beginPath();ctx.arc(x+this.w*.35,y+this.h*.4,1.5,0,6.28);ctx.arc(x+this.w*.65,y+this.h*.4,1.5,0,6.28);ctx.fill();if(this.hp<this.max){ctx.fillStyle='rgba(0,0,0,.5)';ctx.fillRect(x,y-8,this.w,4);ctx.fillStyle='#0F0';ctx.fillRect(x+1,y-7,(this.w-2)*this.hp/this.max,2)}if(this.drainTarget&&this.drainTarget.hp>0){const tx=this.drainTarget.x-cx+this.drainTarget.w/2,ty=this.drainTarget.y+this.drainTarget.h/2;ctx.strokeStyle='rgba(255,0,0,.6)';ctx.lineWidth=3;ctx.beginPath();ctx.moveTo(x+this.w/2,y+this.h/2);ctx.lineTo(tx,ty);ctx.stroke();for(let i=0;i<3;i++){const t=i/3;const px=x+this.w/2+(tx-(x+this.w/2))*t;const py=y+this.h/2+(ty-(y+this.h/2))*t;ctx.fillStyle='#F00';ctx.beginPath();ctx.arc(px,py,3,0,6.28);ctx.fill()}}}atk(t){let bossTarget=null;for(let e of enm){if(e.boss){bossTarget=e;break}}if(bossTarget){const dist=Math.sqrt((bossTarget.x-this.x)**2+(bossTarget.y-this.y)**2);if(dist<300){this.drainTarget=bossTarget;if(t-this.lastDrain>1000){bossTarget.hp-=1;this.lastDrain=t}}else this.drainTarget=null;return}this.drainTarget=null;if(t-this.last<2000)return;let closest=null,minDist=999;for(let e of enm){const dist=Math.sqrt((e.x-this.x)**2+(e.y-this.y)**2);if(dist<minDist){minDist=dist;closest=e}}if(closest&&minDist<80){closest.hp-=30;this.last=t}}}
class Red{constructor(x,y){this.x=x;this.y=y;this.w=20;this.h=28;this.hp=30;this.max=30;this.last=0;this.drainTarget=null;this.lastDrain=0}up(g){const dx=pl.x-this.x,dy=pl.y-this.y;const dist=Math.sqrt(dx*dx+dy*dy);if(dist>100){this.x+=dx/dist*5;this.y+=dy/dist*5}else{const offsetX=(Math.random()-.5)*3;const offsetY=(Math.random()-.5)*3;this.x+=offsetX;this.y+=offsetY}if(this.y+this.h>=g){this.y=g-this.h-.5}else if(this.y<50){this.y=50}}dr(cx){const x=this.x-cx,y=this.y;ctx.fillStyle='rgba(0,0,0,.2)';ctx.fillRect(x+4,y+this.h+2,this.w-8,5);const gr=ctx.createLinearGradient(x,y,x,y+this.h);gr.addColorStop(0,'#FF0000');gr.addColorStop(1,'#CC0000');ctx.fillStyle=gr;ctx.beginPath();ctx.moveTo(x+this.w/2,y+this.h);ctx.lineTo(x+this.w,y+this.h*.3);ctx.lineTo(x+this.w/2,y);ctx.lineTo(x,y+this.h*.3);ctx.fill();ctx.fillStyle='#8B0000';ctx.fillRect(x+this.w/2-5,y-4,4,6);ctx.fillRect(x+this.w/2+1,y-5,4,7);ctx.fillStyle='#FFF';ctx.beginPath();ctx.arc(x+this.w*.35,y+this.h*.35,1.2,0,6.28);ctx.arc(x+this.w*.65,y+this.h*.35,1.2,0,6.28);ctx.fill();if(this.hp<this.max){ctx.fillStyle='rgba(0,0,0,.5)';ctx.fillRect(x,y-7,this.w,3);ctx.fillStyle='#F00';ctx.fillRect(x+1,y-6,(this.w-2)*this.hp/this.max,1)}if(this.drainTarget&&this.drainTarget.hp>0){const tx=this.drainTarget.x-cx+this.drainTarget.w/2,ty=this.drainTarget.y+this.drainTarget.h/2;ctx.strokeStyle='rgba(255,0,0,.5)';ctx.lineWidth=2;ctx.beginPath();ctx.moveTo(x+this.w/2,y+this.h/2);ctx.lineTo(tx,ty);ctx.stroke();for(let i=0;i<2;i++){const t=i/2;const px=x+this.w/2+(tx-(x+this.w/2))*t;const py=y+this.h/2+(ty-(y+this.h/2))*t;ctx.fillStyle='#F00';ctx.beginPath();ctx.arc(px,py,2,0,6.28);ctx.fill()}}}atk(t){if(t-this.lastDrain<1500)return;let closest=null,minDist=350;for(let e of enm){const dist=Math.sqrt((e.x-this.x)**2+(e.y-this.y)**2);if(dist<minDist){minDist=dist;closest=e}}if(closest){this.drainTarget=closest;closest.hp-=5;this.lastDrain=t}else this.drainTarget=null}}
class Giant{constructor(x,y,s){this.x=x+(s==='left'?-70:70);this.y=y;this.w=60;this.h=85;this.hp=150+level*20;this.max=this.hp;this.vy=0;this.vx=0;this.last=0;this.drainTarget=null;this.lastDrain=0}up(g){let n=null,d=999999;for(let e of enm){const dist=Math.sqrt((e.x-this.x)**2+(e.y-this.y)**2);if(dist<d){d=dist;n=e}}if(n&&d>100)this.vx=n.x>this.x?4:n.x<this.x?-4:0;else this.vx=0;this.x+=this.vx;this.vy+=.85;this.y+=this.vy;if(this.y+this.h>=g){this.y=g-this.h;this.vy=0}}dr(cx){const x=this.x-cx,y=this.y;ctx.fillStyle='rgba(0,0,0,.3)';ctx.fillRect(x+10,y+this.h+2,this.w-20,12);const gr=ctx.createLinearGradient(x,y,x,y+this.h);gr.addColorStop(0,'#27AE60');gr.addColorStop(1,'#2ECC71');ctx.fillStyle=gr;ctx.beginPath();ctx.moveTo(x+this.w/2,y+this.h);ctx.lineTo(x+this.w,y+this.h*.25);ctx.lineTo(x+this.w/2,y);ctx.lineTo(x,y+this.h*.25);ctx.fill();ctx.strokeStyle='rgba(255,255,255,.4)';ctx.lineWidth=4;for(let i=1;i<6;i++){ctx.beginPath();ctx.moveTo(x+this.w*.1,y+this.h*i*.15);ctx.lineTo(x+this.w*.9,y+this.h*i*.15);ctx.stroke()}ctx.fillStyle='#1E8449';ctx.fillRect(x+this.w/2-18,y-15,13,20);ctx.fillRect(x+this.w/2-3,y-20,13,25);ctx.fillRect(x+this.w/2+12,y-17,13,22);ctx.fillStyle='#000';ctx.beginPath();ctx.arc(x+this.w*.3,y+this.h*.35,5,0,6.28);ctx.arc(x+this.w*.7,y+this.h*.35,5,0,6.28);ctx.fill();ctx.fillStyle='#FFF';ctx.beginPath();ctx.arc(x+this.w*.3-2,y+this.h*.35-2,2,0,6.28);ctx.arc(x+this.w*.7-2,y+this.h*.35-2,2,0,6.28);ctx.fill();ctx.strokeStyle='#000';ctx.lineWidth=3.5;ctx.beginPath();ctx.arc(x+this.w/2,y+this.h*.5,this.w*.25,0,3.14);ctx.stroke();if(this.drainTarget&&this.drainTarget.hp>0){const tx=this.drainTarget.x-cx+this.drainTarget.w/2,ty=this.drainTarget.y+this.drainTarget.h/2;ctx.strokeStyle='rgba(0,255,0,.7)';ctx.lineWidth=4;ctx.beginPath();ctx.moveTo(x+this.w/2,y+this.h/2);ctx.lineTo(tx,ty);ctx.stroke();for(let i=0;i<3;i++){const t=i/3;const px=x+this.w/2+(tx-(x+this.w/2))*t;const py=y+this.h/2+(ty-(y+this.h/2))*t;ctx.fillStyle='#0F0';ctx.beginPath();ctx.arc(px,py,4,0,6.28);ctx.fill()}}if(this.hp<this.max){ctx.fillStyle='rgba(0,0,0,.6)';ctx.fillRect(x,y-18,this.w,8);ctx.fillStyle='#0F0';ctx.fillRect(x+2,y-16,(this.w-4)*this.hp/this.max,4)}}atk(t){let bossTarget=null;for(let e of enm){if(e.boss){bossTarget=e;break}}if(bossTarget){const dist=Math.sqrt((bossTarget.x-this.x)**2+(bossTarget.y-this.y)**2);if(dist<400){this.drainTarget=bossTarget;if(t-this.lastDrain>1000){bossTarget.hp-=2;this.lastDrain=t}}else this.drainTarget=null;return}this.drainTarget=null;if(t-this.last<1500)return;let closest=null,minDist=999;for(let e of enm){const dist=Math.sqrt((e.x-this.x)**2+(e.y-this.y)**2);if(dist<minDist){minDist=dist;closest=e}}if(closest&&minDist<100){closest.hp-=40;this.last=t}}}
class Bomb{constructor(x,y){this.x=x;this.y=y;this.w=30;this.h=40;this.vy=0;this.vx=0;this.target=null;this.speed=8;this.exploded=0}up(g){if(!this.target||this.target.hp<=0){let n=null,d=400;for(let e of enm){const dist=Math.sqrt((e.x-this.x)**2+(e.y-this.y)**2);if(dist<d&&e.hp>0){d=dist;n=e}}this.target=n}if(this.target){const dx=this.target.x-this.x,dy=this.target.y-this.y,dist=Math.sqrt(dx*dx+dy*dy);if(dist>30){this.vx=dx/dist*this.speed;this.vy=dy/dist*this.speed}else{this.explode();return 1}}else this.vy+=.85;this.x+=this.vx;this.y+=this.vy;if(this.y+this.h>=g){this.y=g-this.h;this.vy=0}return 0}explode(){if(this.exploded)return;this.exploded=1;const ex=this.x-cam.x,ey=this.y;for(let i=0;i<3;i++){ctx.fillStyle=`rgba(255,${100-i*30},0,${.6-i*.2})`;ctx.beginPath();ctx.arc(ex,ey,150-i*30,0,6.28);ctx.fill()}for(let i=enm.length-1;i>=0;i--){const e=enm[i];const dist=Math.sqrt((e.x-this.x)**2+(e.y-this.y)**2);if(dist<150){e.hp-=Math.floor(e.maxHp*.9)}}}dr(cx){const x=this.x-cx,y=this.y;ctx.fillStyle='rgba(0,0,0,.3)';ctx.fillRect(x+5,y+this.h+2,this.w-10,6);const gr=ctx.createLinearGradient(x,y,x,y+this.h);gr.addColorStop(0,'#2C3E50');gr.addColorStop(1,'#34495E');ctx.fillStyle=gr;ctx.beginPath();ctx.moveTo(x+this.w/2,y+this.h);ctx.lineTo(x+this.w,y+this.h*.3);ctx.lineTo(x+this.w/2,y);ctx.lineTo(x,y+this.h*.3);ctx.fill();ctx.fillStyle='#E74C3C';ctx.fillRect(x+this.w/2-8,y-8,6,12);ctx.fillRect(x+this.w/2-2,y-10,6,12);ctx.fillRect(x+this.w/2+4,y-9,6,12);ctx.fillStyle='#FFF';ctx.beginPath();ctx.arc(x+this.w*.35,y+this.h*.4,2,0,6.28);ctx.arc(x+this.w*.65,y+this.h*.4,2,0,6.28);ctx.fill()}}
class Ene{constructor(b,sx,type){this.boss=b;this.type=type||0;if(b){this.w=95;this.h=115}else if(type===1){this.w=70;this.h=95}else{this.w=58;this.h=78}this.x=sx;this.y=0;const hpM=Math.pow(1.5,level-1);if(b)this.hp=Math.floor(350*hpM);else if(type===1)this.hp=Math.floor(150*hpM);else this.hp=Math.floor(50*hpM);this.maxHp=this.hp;const spdM=1+(level-1)*.2;if(type===1)this.spd=1.2*spdM;else this.spd=(b?2:2.5)*spdM;const dmgM=Math.pow(1.3,level-1);if(type===1)this.dmg=30;else this.dmg=b?Math.floor(30*dmgM):Math.floor(10*dmgM);this.last=0;this.atkCD=type===1?3500:2500}up(g,t){let n=null,d=999999;for(let m of mins){const dist=Math.sqrt((m.x-this.x)**2+(m.y-this.y)**2);if(dist<d){d=dist;n=m}}for(let gt of giants){const dist=Math.sqrt((gt.x-this.x)**2+(gt.y-this.y)**2);if(dist<d){d=dist;n=gt}}for(let r of reds){const dist=Math.sqrt((r.x-this.x)**2+(r.y-this.y)**2);if(dist<d){d=dist;n=r}}if(!n||d>300){n=pl;d=Math.sqrt((pl.x-this.x)**2+(pl.y-this.y)**2)}if(d>60){if(n.x<this.x)this.x-=this.spd;else if(n.x>this.x)this.x+=this.spd}if(d<60&&t-this.last>this.atkCD){n.hp-=this.dmg;this.last=t}this.y=g-this.h}dr(cx){const x=this.x-cx,y=this.y,w=this.w,h=this.h;ctx.fillStyle='rgba(0,0,0,.25)';ctx.fillRect(x+8,y+h+2,w-16,10);let color='#FFF';if(this.boss)color='#D3D3D3';else if(this.type===1)color='#90EE90';ctx.fillStyle=color;ctx.fillRect(x+w*.2,y+h*.4,w*.6,h*.5);ctx.beginPath();ctx.arc(x+w/2,y+h*.35,w*.35,0,6.28);ctx.fill();ctx.fillRect(x+w*.25,y,w*.12,h*.4);ctx.fillRect(x+w*.63,y,w*.12,h*.4);let innerColor='#FFE4E1';if(this.boss)innerColor='#FFB6C1';else if(this.type===1)innerColor='#C1FFC1';ctx.fillStyle=innerColor;ctx.fillRect(x+w*.28,y+5,w*.06,h*.3);ctx.fillRect(x+w*.66,y+5,w*.06,h*.3);ctx.fillStyle=color;ctx.fillRect(x+w*.25,y+h*.85,w*.2,h*.1);ctx.fillRect(x+w*.55,y+h*.85,w*.2,h*.1);ctx.fillStyle='#000';ctx.fillRect(x+w*.32,y+h*.28,w*.12,w*.12);ctx.fillRect(x+w*.56,y+h*.28,w*.12,w*.12);ctx.fillStyle='#FFF';ctx.fillRect(x+w*.34,y+h*.3,w*.04,w*.04);ctx.fillRect(x+w*.58,y+h*.3,w*.04,w*.04);ctx.fillStyle='#FF69B4';ctx.beginPath();ctx.moveTo(x+w/2,y+h*.45);ctx.lineTo(x+w/2-5,y+h*.42);ctx.lineTo(x+w/2+5,y+h*.42);ctx.fill();ctx.strokeStyle='#000';ctx.lineWidth=2;ctx.beginPath();ctx.moveTo(x+w/2,y+h*.45);ctx.lineTo(x+w/2,y+h*.5);ctx.stroke();ctx.beginPath();ctx.arc(x+w*.4,y+h*.53,5,0,3.14);ctx.stroke();ctx.beginPath();ctx.arc(x+w*.6,y+h*.53,5,0,3.14);ctx.stroke();if(this.hp<this.maxHp){ctx.fillStyle='rgba(0,0,0,.6)';ctx.fillRect(x,y-14,w,7);let barColor='#0F0';if(this.boss)barColor='#F00';else if(this.type===1)barColor='#00FF00';ctx.fillStyle=barColor;ctx.fillRect(x+1,y-13,(w-2)*this.hp/this.maxHp,5)}if(this.boss){ctx.fillStyle='#FFD700';ctx.font='bold 18px Arial';ctx.textAlign='center';ctx.fillText('üëë BOSS',x+w/2,y-22)}}}
function loop(){const G=c.height-85,t=Date.now();ctx.clearRect(0,0,c.width,c.height);cam.x=pl.x-c.width/2+pl.w/2;const sky=ctx.createLinearGradient(0,0,0,G);sky.addColorStop(0,'#87CEEB');sky.addColorStop(1,'#B0E0E6');ctx.fillStyle=sky;ctx.fillRect(0,0,c.width,G);ctx.fillStyle='rgba(255,255,255,.7)';for(let i=0;i<10;i++){const cx=(i*300+t/50)-cam.x*.3,sx=cx%(c.width+400);ctx.beginPath();ctx.arc(sx,80+i*15,30,0,6.28);ctx.arc(sx+35,80+i*15,25,0,6.28);ctx.arc(sx+20,70+i*15,20,0,6.28);ctx.fill()}ctx.fillStyle='#90EE90';ctx.fillRect(0,G,c.width,c.height);ctx.fillStyle='#228B22';ctx.fillRect(0,G-4,c.width,4);ctx.fillStyle='#8B4513';const st=Math.floor(cam.x/25)*25;for(let i=st;i<st+c.width+50;i+=25)ctx.fillRect(i-cam.x,G+25,18,45);ctx.strokeStyle='#228B22';ctx.lineWidth=3;const sg=Math.floor(cam.x/15)*15;for(let i=sg;i<sg+c.width+30;i+=15){ctx.beginPath();ctx.moveTo(i-cam.x,G);ctx.lineTo(i-cam.x-3,G-12);ctx.stroke()}if(k.l){pl.vx=-6;pl.dir=-1}else if(k.r){pl.vx=6;pl.dir=1}else pl.vx=0;if(k.j&&pl.onG){pl.vy=-17;pl.onG=0}pl.vy+=.85;pl.x+=pl.vx;pl.y+=pl.vy;if(pl.y+pl.h>=G){pl.y=G-pl.h;pl.vy=0;pl.onG=1}else pl.onG=0;if(k.s&&t-lastS>240){bul.push({x:pl.x+(pl.dir>0?pl.w:0),y:pl.y+pl.h/2,vx:13*pl.dir});playShoot();lastS=t}if(k.sk1&&t-lastSk1>15000){if(mins.length<4){mins.push(new Min(pl.x,pl.y,'left'));mins.push(new Min(pl.x,pl.y,'right'));mins.push(new Min(pl.x,pl.y-20,'left2'));mins.push(new Min(pl.x,pl.y-20,'right2'))}reds.push(new Red(pl.x-30,pl.y));reds.push(new Red(pl.x+30,pl.y));bombs.push(new Bomb(pl.x,pl.y));lastSk1=t;k.sk1=0}if(k.sk2&&t-lastSk2>20000&&giants.length<2&&level>=3){giants.push(new Giant(pl.x,pl.y,'left'));giants.push(new Giant(pl.x,pl.y,'right'));lastSk2=t;k.sk2=0}for(let i=mins.length-1;i>=0;i--){mins[i].up(G);mins[i].atk(t);if(mins[i].hp<=0)mins.splice(i,1)}for(let i=reds.length-1;i>=0;i--){reds[i].up(G);reds[i].atk(t);if(reds[i].hp<=0)reds.splice(i,1)}for(let i=giants.length-1;i>=0;i--){giants[i].up(G);giants[i].atk(t);if(giants[i].hp<=0)giants.splice(i,1)}for(let i=bombs.length-1;i>=0;i--){const ex=bombs[i].up(G);if(ex||bombs[i].exploded){if(!bombs[i].exploded)bombs[i].explode();setTimeout(()=>bombs.splice(i,1),100)}}ctx.fillStyle='rgba(0,0,0,.25)';ctx.fillRect(pl.x-cam.x+8,G+2,pl.w-16,10);for(let m of mins)m.dr(cam.x);for(let r of reds)r.dr(cam.x);for(let gt of giants)gt.dr(cam.x);for(let b of bombs)b.dr(cam.x);const px=pl.x-cam.x,py=pl.y;ctx.save();ctx.translate(pl.dir<0?px+pl.w:px,py);if(pl.dir<0)ctx.scale(-1,1);const gr=ctx.createLinearGradient(0,0,0,pl.h);gr.addColorStop(0,'#FF6B35');gr.addColorStop(1,'#FF8C42');ctx.fillStyle=gr;ctx.beginPath();ctx.moveTo(pl.w/2,pl.h);ctx.lineTo(pl.w,pl.h*.28);ctx.lineTo(pl.w/2,0);ctx.lineTo(0,pl.h*.28);ctx.fill();ctx.strokeStyle='rgba(255,255,255,.35)';ctx.lineWidth=2.5;for(let i=1;i<5;i++){ctx.beginPath();ctx.moveTo(pl.w*.15,pl.h*i*.18);ctx.lineTo(pl.w*.85,pl.h*i*.18);ctx.stroke()}ctx.fillStyle='#228B22';ctx.fillRect(pl.w/2-14,-10,11,17);ctx.fillRect(pl.w/2-2,-14,11,17);ctx.fillRect(pl.w/2+10,-11,11,17);ctx.fillStyle='#000';ctx.beginPath();ctx.arc(pl.w*.32,pl.h*.38,3.5,0,6.28);ctx.arc(pl.w*.68,pl.h*.38,3.5,0,6.28);ctx.fill();ctx.strokeStyle='#000';ctx.lineWidth=2.2;ctx.beginPath();ctx.arc(pl.w/2,pl.h*.48,pl.w*.22,0,3.14);ctx.stroke();ctx.restore();for(let i=bul.length-1;i>=0;i--){const b=bul[i];b.x+=b.vx;const bx=b.x-cam.x,by=b.y;ctx.save();ctx.translate(bx,by);if(b.vx<0)ctx.rotate(3.14);ctx.fillStyle='#FF6B35';ctx.beginPath();ctx.moveTo(28,0);ctx.lineTo(0,-7);ctx.lineTo(0,7);ctx.fill();ctx.fillStyle='#228B22';ctx.fillRect(-4,-2.5,6,5);ctx.restore();if(Math.abs(b.x-pl.x)>1000){bul.splice(i,1);continue}for(let j=enm.length-1;j>=0;j--){const e=enm[j];if(b.x>e.x&&b.x<e.x+e.w&&b.y>e.y&&b.y<e.y+e.h){e.hp-=10;bul.splice(i,1);break}}}const spR=Math.max(600,1200-level*40);if(!boss&&t-lastE>spR&&bCnt<bossReq){const side=Math.random()>.5?1:-1;const need=Math.max(1,bossReq-bCnt);const num=Math.min(4,Math.min(need,2+Math.floor(level/2)));for(let i=0;i<num;i++){const typ=Math.random()<.25?1:0;enm.push(new Ene(0,pl.x+side*(350+Math.random()*250+i*120),typ))}lastE=t}for(let i=enm.length-1;i>=0;i--){enm[i].up(G,t);enm[i].dr(cam.x);if(enm[i].hp<=0){enm.splice(i,1);kills++;bCnt++;if(bCnt>=bossReq&&!boss){enm.push(new Ene(1,pl.x+400,0));boss=1;bCnt=0;level++;bossReq=20+(level-1)*5}continue}if(Math.abs(enm[i].x-pl.x)>1500)enm.splice(i,1)}if(boss){let a=0;for(let e of enm)if(e.boss){a=1;break}if(!a)boss=0}if(pl.hp<=0){alert('GAME OVER!\nüíÄ Kills: '+kills+'\nüìà Level: '+level);location.reload()}document.getElementById('hp').textContent=Math.max(0,Math.floor(pl.hp));document.getElementById('k').textContent=kills;document.getElementById('p').textContent=bCnt+'/'+bossReq;document.getElementById('lv').textContent=level;const cd1=Math.max(0,15000-(t-lastSk1));if(cd1>0){document.getElementById('sb1').textContent=Math.ceil(cd1/1000);document.getElementById('SK1').style.opacity='.5'}else{document.getElementById('sb1').textContent='‚ö°';document.getElementById('SK1').style.opacity='1'}const cd2=Math.max(0,20000-(t-lastSk2));if(level<3){document.getElementById('sb2').textContent='üîí';document.getElementById('SK2').style.opacity='.3';document.getElementById('SK2').style.background='linear-gradient(145deg,#333,#111)'}else if(cd2>0){document.getElementById('sb2').textContent=Math.ceil(cd2/1000);document.getElementById('SK2').style.opacity='.5';document.getElementById('SK2').style.background='linear-gradient(145deg,#2ECC71,#27AE60)'}else{document.getElementById('sb2').textContent='üó°Ô∏è';document.getElementById('SK2').style.opacity='1';document.getElementById('SK2').style.background='linear-gradient(145deg,#2ECC71,#27AE60)'}requestAnimationFrame(loop)}
setTimeout(loop,100);
</script></body></html>
